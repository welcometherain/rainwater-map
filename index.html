<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rainwater Catchment Calculator</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f5e6d3;
      color: #5c4326;
      padding: 2rem;
      max-width: 600px;
      margin: auto;
    }
    h1 {
      text-align: center;
      color: #5c4326;
    }
    label {
      display: block;
      margin-top: 1rem;
    }
    input {
      padding: 0.5rem;
      width: 100%;
      margin-top: 0.25rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      margin-top: 1rem;
      padding: 0.75rem;
      background-color: #c8a57b;
      border: none;
      border-radius: 4px;
      color: white;
      font-size: 1rem;
      cursor: pointer;
    }
    button:hover {
      background-color: #a97d51;
    }
    #result, #rainfallData {
      margin-top: 1rem;
      padding: 1rem;
      background: #fff9f3;
      border-left: 4px solid #c8a57b;
    }
  </style>
</head>
<body>
  <h1>Rainwater Catchment Calculator</h1>
  <label for="zip">Enter ZIP Code:</label>
  <input type="text" id="zip" placeholder="e.g., 90210" />
  <button onclick="getRainfall()">Get Rainfall Data</button>

  <label for="area">Catchment Area (sq ft):</label>
  <input type="number" id="area" placeholder="e.g., 1000" />

  <label for="rainfall">Annual Rainfall (inches):</label>
  <input type="text" id="rainfall" placeholder="inches/year" readonly />

  <button onclick="calculateCatchment()">Calculate Catchment</button>

  <div id="result"></div>
  <div id="rainfallData"></div>

  <script>
    async function getRainfall() {
      const zip = document.getElementById("zip").value;
      if (!zip) return alert("Please enter a ZIP code.");

      try {
        const zipRes = await fetch(`https://api.zippopotam.us/us/${zip}`);
        if (!zipRes.ok) throw new Error("ZIP not found");
        const zipData = await zipRes.json();
        const lat = parseFloat(zipData.places[0].latitude);
        const lon = parseFloat(zipData.places[0].longitude);

        const apiUrl = `https://climate-api.open-meteo.com/v1/climate?latitude=${lat}&longitude=${lon}&start_year=1991&end_year=2020&models=ERA5`;

        document.getElementById("rainfall").value = "Fetching...";
        document.getElementById("rainfallData").innerHTML = "";

        const response = await fetch(apiUrl);
        const data = await response.json();
        const monthly = data?.monthly?.precipitation_sum;

        if (!monthly || monthly.length !== 12) throw new Error("Invalid climate data");

        const monthlyInches = monthly.map(mm => (mm * 0.0393701).toFixed(2));
        const totalInches = monthly.reduce((sum, mm) => sum + mm, 0) * 0.0393701;

        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        let rainfallText = '<h3>Average Monthly Rainfall (1991â€“2020):</h3><ul>';

        monthlyInches.forEach((inches, i) => {
          rainfallText += `<li>${months[i]}: ${inches} inches</li>`;
        });

        rainfallText += '</ul>';
        document.getElementById("rainfallData").innerHTML = rainfallText;
        document.getElementById("rainfall").value = totalInches.toFixed(1);

      } catch (err) {
        alert("Could not fetch rainfall data. Try another ZIP.");
        console.error(err);
        document.getElementById("rainfall").value = "Error";
      }
    }

    function calculateCatchment() {
      const area = parseFloat(document.getElementById("area").value);
      const rainfall = parseFloat(document.getElementById("rainfall").value);
      if (isNaN(area) || isNaN(rainfall)) {
        document.getElementById("result").textContent = "Please enter valid numbers.";
        return;
      }
      const gallons = area * rainfall * 0.623;
      document.getElementById("result").textContent =
        `You can harvest approximately ${gallons.toFixed(0)} gallons of rainwater per year.`;
    }
  </script>
</body>
</html>
